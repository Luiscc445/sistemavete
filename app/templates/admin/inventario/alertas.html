{% extends "base.html" %}
{% block title %}Alertas de Inventario{% endblock %}

{% block page_title %}
    <i class="bi bi-bell-fill me-2"></i> Alertas de Inventario
{% endblock %}

{% block breadcrumb %}
<ol class="breadcrumb mb-4">
    <li class="breadcrumb-item"><a href="{{ url_for('admin.dashboard') }}">Dashboard</a></li>
    <li class="breadcrumb-item"><a href="{{ url_for('inventario.lista') }}">Inventario</a></li>
    <li class="breadcrumb-item active">Alertas</li>
</ol>
{% endblock %}

{% block content %}
<!-- Medicamentos vencidos -->
<div class="card mb-4 border-danger">
    <div class="card-header bg-danger text-white">
        <i class="bi bi-x-circle me-1"></i> Medicamentos Vencidos ({{ vencidos|length }})
    </div>
    <div class="card-body">
        {% if vencidos %}
            <div class="table-responsive">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Código</th>
                            <th>Nombre</th>
                            <th>Lote</th>
                            <th>Fecha Vencimiento</th>
                            <th>Stock</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for med in vencidos %}
                        <tr>
                            <td>{{ med.codigo or 'N/A' }}</td>
                            <td>{{ med.nombre }}</td>
                            <td>{{ med.lote or 'N/A' }}</td>
                            <td>{{ med.fecha_vencimiento.strftime('%d/%m/%Y') }}</td>
                            <td>{{ med.stock_actual }} {{ med.unidad_medida }}</td>
                            <td>
                                <a href="{{ url_for('inventario.ver', med_id=med.id) }}" class="btn btn-sm btn-primary">Ver</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p class="text-muted mb-0">No hay medicamentos vencidos</p>
        {% endif %}
    </div>
</div>

<!-- Medicamentos por vencer -->
<div class="card mb-4 border-warning">
    <div class="card-header bg-warning text-dark">
        <i class="bi bi-clock me-1"></i> Medicamentos por Vencer (próximos 30 días) ({{ por_vencer|length }})
    </div>
    <div class="card-body">
        {% if por_vencer %}
            <div class="table-responsive">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Código</th>
                            <th>Nombre</th>
                            <th>Lote</th>
                            <th>Fecha Vencimiento</th>
                            <th>Stock</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for med in por_vencer %}
                        <tr>
                            <td>{{ med.codigo or 'N/A' }}</td>
                            <td>{{ med.nombre }}</td>
                            <td>{{ med.lote or 'N/A' }}</td>
                            <td>{{ med.fecha_vencimiento.strftime('%d/%m/%Y') }}</td>
                            <td>{{ med.stock_actual }} {{ med.unidad_medida }}</td>
                            <td>
                                <a href="{{ url_for('inventario.ver', med_id=med.id) }}" class="btn btn-sm btn-primary">Ver</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p class="text-muted mb-0">No hay medicamentos por vencer en los próximos 30 días</p>
        {% endif %}
    </div>
</div>

<!-- Medicamentos con bajo stock -->
<div class="card mb-4 border-info">
    <div class="card-header bg-info text-white">
        <i class="bi bi-exclamation-triangle me-1"></i> Medicamentos con Bajo Stock ({{ bajo_stock|length }})
    </div>
    <div class="card-body">
        {% if bajo_stock %}
            <div class="table-responsive">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Código</th>
                            <th>Nombre</th>
                            <th>Stock Actual</th>
                            <th>Stock Mínimo</th>
                            <th>Diferencia</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for med in bajo_stock %}
                        <tr>
                            <td>{{ med.codigo or 'N/A' }}</td>
                            <td>{{ med.nombre }}</td>
                            <td>{{ med.stock_actual }} {{ med.unidad_medida }}</td>
                            <td>{{ med.stock_minimo }} {{ med.unidad_medida }}</td>
                            <td class="text-danger">{{ med.stock_minimo - med.stock_actual }} {{ med.unidad_medida }}</td>
                            <td>
                                <a href="{{ url_for('inventario.ver', med_id=med.id) }}" class="btn btn-sm btn-primary">Ver</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p class="text-muted mb-0">No hay medicamentos con bajo stock</p>
        {% endif %}
    </div>
</div>

<div class="mt-3">
    <a href="{{ url_for('inventario.lista') }}" class="btn btn-secondary">
        <i class="bi bi-arrow-left me-1"></i> Volver al Inventario
    </a>
</div>
{% endblock %}
